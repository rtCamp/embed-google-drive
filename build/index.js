!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t,r){var n=r(9);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t,r){var n=r(10),o=r(8);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?o(e):t}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e,t){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}e.exports=r},function(e,t){!function(){e.exports=this.wp.blocks}()},function(e,t,r){var n=r(3),o=r(9),i=r(15),c=r(16);function l(t){var r="function"==typeof Map?new Map:void 0;return e.exports=l=function(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return c(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,e)},l(t)}e.exports=l},function(e,t){!function(){e.exports=this.wp.apiFetch}()},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,r){var n=r(9);function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function i(t,r,c){return o()?e.exports=i=Reflect.construct:e.exports=i=function(e,t,r){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return r&&n(i,r.prototype),i},i.apply(null,arguments)}e.exports=i},function(e,t,r){"use strict";r.r(t);var n=r(11),o=r(1),i=r(0),c=Object(i.createElement)("svg",{width:"20px",height:"20px",viewBox:"0 0 25 25",xmlns:"http://www.w3.org/2000/svg"},Object(i.createElement)("path",{d:"m12.065 8.13-3.843-6.63-8.222 14.367 3.778 6.633z",fill:"#4caf50"}),Object(i.createElement)("path",{d:"m8.222 1.5 8.309 14.367h7.469l-8.222-14.367z",fill:"#ffc107"}),Object(i.createElement)("path",{d:"m7.603 15.867-3.825 6.633h16.444l3.778-6.633z",fill:"#2196f3"})),l={title:Object(o.__)("Google Drive File Preview","rt-google-embeds"),icon:c,category:"common",keywords:[Object(o.__)("Google Drive File Preview","rt-google-embeds"),Object(o.__)("Drive File Preview","rt-google-embeds"),Object(o.__)("Drive","rt-google-embeds")],attributes:{previewURL:{type:"string"},docURL:{type:"string"}}},u=r(10),s=r.n(u),a=r(12),p=r.n(a),f=r(5),b=r.n(f),d=r(6),g=r.n(d),m=r(7),h=r.n(m),v=r(3),y=r.n(v),O=r(8),w=r.n(O),j=r(4),_=r.n(j),x=r(13),E=r.n(x),S=r(14),R=r(2);function P(e,t){P=function(e,t){return new i(e,void 0,t)};var r=p()(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return _()(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==s()(e[e.length-1])&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},P.apply(this,arguments)}var k=window.rtGoogleEmbedBlockData.noPreviewURL,D=function(e){function t(){var e;return b()(this,t),(e=h()(this,y()(t).apply(this,arguments))).state={preview:!1,apiRequestOutstanding:!1},e.apiCall=e.apiCall.bind(w()(e)),e.onError=e.onError.bind(w()(e)),e}return _()(t,e),g()(t,[{key:"componentDidMount",value:function(){this.props.attributes.previewURL&&this.setState({preview:!0})}},{key:"getFileID",value:function(e){var t={doc:P(/https:\/\/docs\.google\.com\/document\/d\/(.*?)\/(.*)/,{fileid:1}),sheets:P(/https:\/\/docs\.google\.com\/spreadsheets\/d\/(.*?)\/(.*)/,{fileid:1}),sheet:P(/https:\/\/docs\.google\.com\/spreadsheets\/d\/(.*?)\/(.*)/,{fileid:1}),slides:P(/https:\/\/docs\.google\.com\/presentation\/d\/(.*?)\/(.*)/,{fileid:1}),commonDrive:P(/https:\/\/drive\.google\.com\/open\?id=(.*)/,{fileid:1}),normaFile:P(/https:\/\/drive\.google\.com\/file\/d\/(.*?)\/(.*)/,{fileid:1})},r=!1;if(Object.keys(t).some((function(n,o){if(null!==t[n].exec(e))return r=!0,!0})),!r)return"";var n="";if(e.trim().length){var o=new URL(e),i=o.pathname,c=o.search,l=P(/\/(document|spreadsheets|presentation|file)\/d\/(.*?)\/(.*)/,{fileid:2}),u=P(/(id)=(.*)/,{fileid:2}),s=i.match(l),a=c.match(u);null!==s&&s.hasOwnProperty("groups")&&s.groups.fileid.length?n=s.groups.fileid:null!==a&&a.hasOwnProperty("groups")&&a.groups.fileid.length&&(n=a.groups.fileid)}return n}},{key:"apiCall",value:function(e){var t=this;this.props.setAttributes({docURL:e});var r=this.getFileID(e),n=this.props.noticeOperations;r?this.setState({apiRequestOutstanding:!0},(function(){E()({path:"/rt-google-embed/v1/get-preview-url?file_id="+r}).then((function(e){n.removeAllNotices(),t.props.setAttributes({previewURL:e.preview_url}),t.setState({apiRequestOutstanding:!1,preview:!0})}),(function(e){t.props.setAttributes({previewURL:k}),t.onError(Object(o.__)("Something went wrong","rt-google-embeds")),t.setState({apiRequestOutstanding:!1,preview:!0})}))})):(this.onError(Object(o.__)("Invalid Drive URL.","rt-google-embeds")),this.setState({preview:!1}))}},{key:"onError",value:function(e){var t=this.props.noticeOperations;t.removeAllNotices(),t.createErrorNotice(e)}},{key:"render",value:function(){var e=this,t=this.props,r=t.className,n=t.attributes,c=t.noticeUI,u=t.notices,s=n.docURL,a=n.previewURL,p=this.state,f=p.apiRequestOutstanding,b=p.preview,d=Object(i.createElement)(S.BlockControls,null,Object(i.createElement)(R.Toolbar,null,Object(i.createElement)(R.IconButton,{icon:"edit",label:b?Object(o.__)("Edit file URL","rt-google-embeds"):Object(o.__)("Show Preview","rt-google-embeds"),onClick:function(){return e.setState({preview:!b})}}))),g=Object(i.createElement)(R.Placeholder,{icon:l.icon},Object(i.createElement)(R.Spinner,null)),m=Object(i.createElement)(R.Placeholder,{icon:l.icon,label:Object(o.__)("Google Drive File Preview","map-blocks"),notices:u},Object(i.createElement)(i.Fragment,null,a&&d,Object(i.createElement)("div",{className:r},Object(o.__)("Paste your Google Drive Sharing URL into the field below.","rt-google-embeds")),Object(i.createElement)(R.TextControl,{placeholder:Object(o.__)("Paste File URL Here","rt-google-embeds"),value:s,onChange:function(t){return e.apiCall(t)}}))),h=Object(i.createElement)(i.Fragment,null,a&&d,Object(i.createElement)("div",{className:"rt-google-doc-embed"},Object(i.createElement)("a",{href:s,title:Object(o.__)("Open the Shared Document","rt-google-embeds"),target:"_blank",rel:"noopener noreferrer"},Object(o.__)("Open the Shared Document","rt-google-embeds")),Object(i.createElement)("img",{src:a,alt:Object(o.__)("Shared Document Preview","rt-google-embeds")})));return Object(i.createElement)(i.Fragment,null,c,!b&&f&&g,!b&&!f&&m,b&&h)}}]),t}(i.Component),U=Object(R.withNotices)(D),L=function(e){function t(){return b()(this,t),h()(this,y()(t).apply(this,arguments))}return _()(t,e),g()(t,[{key:"render",value:function(){var e=this.props.attributes,t=e.docURL,r=e.previewURL;return Object(i.createElement)(i.Fragment,null,Object(i.createElement)("div",{className:"rt-google-doc-embed"},Object(i.createElement)("a",{href:t,title:Object(o.__)("Open the Shared Document","rt-google-embeds"),target:"_blank",rel:"noopener noreferrer"},Object(o.__)("Open the Shared Document","rt-google-embeds")),Object(i.createElement)("img",{src:r,alt:Object(o.__)("Shared Document Preview","rt-google-embeds")})))}}]),t}(i.Component);Object(n.registerBlockType)("rt-google-embed/drive-file-preview",{title:l.title,category:l.category,icon:l.icon,keywords:l.keywords,attributes:l.attributes,edit:U,save:L})}]);