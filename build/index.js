!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(9);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(10),o=n(8);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){var r=n(3),o=n(9),i=n(15),c=n(16);function l(t){var n="function"==typeof Map?new Map:void 0;return e.exports=l=function(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return c(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,e)},l(t)}e.exports=l},function(e,t){!function(){e.exports=this.wp.apiFetch}()},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){!function(){e.exports=this.wp.blocks}()},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){var r=n(9);function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function i(t,n,c){return o()?e.exports=i=Reflect.construct:e.exports=i=function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&r(i,n.prototype),i},i.apply(null,arguments)}e.exports=i},function(e,t,n){"use strict";n.r(t);n(14);var r=n(1),o=n(0),i=Object(o.createElement)("svg",{width:"20px",height:"20px",viewBox:"0 0 25 25",xmlns:"http://www.w3.org/2000/svg"},Object(o.createElement)("path",{d:"m12.065 8.13-3.843-6.63-8.222 14.367 3.778 6.633z",fill:"#4caf50"}),Object(o.createElement)("path",{d:"m8.222 1.5 8.309 14.367h7.469l-8.222-14.367z",fill:"#ffc107"}),Object(o.createElement)("path",{d:"m7.603 15.867-3.825 6.633h16.444l3.778-6.633z",fill:"#2196f3"})),c={title:Object(r.__)("Google Drive File Preview","rt-google-embeds"),icon:i,category:"common",keywords:[Object(r.__)("Google Drive File Preview","rt-google-embeds"),Object(r.__)("Drive File Preview","rt-google-embeds"),Object(r.__)("Drive","rt-google-embeds")],attributes:{previewURL:{type:"string"},docURL:{type:"string"}}},l=n(10),u=n.n(l),s=n(11),a=n.n(s),p=n(5),f=n.n(p),b=n(6),d=n.n(b),g=n(7),h=n.n(g),m=n(3),v=n.n(m),y=n(8),O=n.n(y),w=n(4),j=n.n(w),_=n(12),x=n.n(_),E=n(13),S=n(2);function R(e,t){R=function(e,t){return new i(e,void 0,t)};var n=a()(RegExp),r=RegExp.prototype,o=new WeakMap;function i(e,t,r){var i=n.call(this,e,t);return o.set(i,r||o.get(e)),i}function c(e,t){var n=o.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return j()(i,n),i.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=o.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var i=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==u()(e[e.length-1])&&e.push(c(e,i)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},R.apply(this,arguments)}var P=window.rtGoogleEmbedBlockData.noPreviewURL,k=function(e){function t(){var e;return f()(this,t),(e=h()(this,v()(t).apply(this,arguments))).state={preview:!1,apiRequestOutstanding:!1},e.apiCall=e.apiCall.bind(O()(e)),e.onError=e.onError.bind(O()(e)),e}return j()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.props.attributes.previewURL&&this.setState({preview:!0})}},{key:"getFileID",value:function(e){var t={doc:R(/https:\/\/docs\.google\.com\/document\/d\/(.*?)\/(.*)/,{fileid:1}),sheets:R(/https:\/\/docs\.google\.com\/spreadsheets\/d\/(.*?)\/(.*)/,{fileid:1}),sheet:R(/https:\/\/docs\.google\.com\/spreadsheets\/d\/(.*?)\/(.*)/,{fileid:1}),slides:R(/https:\/\/docs\.google\.com\/presentation\/d\/(.*?)\/(.*)/,{fileid:1}),commonDrive:R(/https:\/\/drive\.google\.com\/open\?id=(.*)/,{fileid:1}),normaFile:R(/https:\/\/drive\.google\.com\/file\/d\/(.*?)\/(.*)/,{fileid:1})},n=!1;if(Object.keys(t).some((function(r,o){return null!==t[r].exec(e)&&(n=!0,!0)})),!n)return"";var r="";if(e.trim().length){var o=new URL(e),i=o.pathname,c=o.search,l=R(/\/(document|spreadsheets|presentation|file)\/d\/(.*?)\/(.*)/,{fileid:2}),u=R(/(id)=(.*)/,{fileid:2}),s=i.match(l),a=c.match(u);null!==s&&s.hasOwnProperty("groups")&&s.groups.fileid.length?r=s.groups.fileid:null!==a&&a.hasOwnProperty("groups")&&a.groups.fileid.length&&(r=a.groups.fileid)}return r}},{key:"apiCall",value:function(e){var t=this;this.props.setAttributes({docURL:e});var n=this.getFileID(e),o=this.props.noticeOperations;n?this.setState({apiRequestOutstanding:!0},(function(){x()({path:"/rt-google-embed/v1/get-preview-url?file_id="+n}).then((function(e){o.removeAllNotices(),t.props.setAttributes({previewURL:e.preview_url}),t.setState({apiRequestOutstanding:!1,preview:!0})}),(function(e){t.props.setAttributes({previewURL:P}),t.onError(Object(r.__)("Something went wrong","rt-google-embeds")),t.setState({apiRequestOutstanding:!1,preview:!0})}))})):(this.onError(Object(r.__)("Invalid Drive URL.","rt-google-embeds")),this.setState({preview:!1}))}},{key:"onError",value:function(e){var t=this.props.noticeOperations;t.removeAllNotices(),t.createErrorNotice(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,i=t.attributes,l=t.noticeUI,u=t.notices,s=i.docURL,a=i.previewURL,p=this.state,f=p.apiRequestOutstanding,b=p.preview,d=Object(o.createElement)(E.BlockControls,null,Object(o.createElement)(S.Toolbar,null,Object(o.createElement)(S.IconButton,{icon:"edit",label:b?Object(r.__)("Edit file URL","rt-google-embeds"):Object(r.__)("Show Preview","rt-google-embeds"),onClick:function(){return e.setState({preview:!b})}}))),g=Object(o.createElement)(S.Placeholder,{icon:c.icon},Object(o.createElement)(S.Spinner,null)),h=Object(o.createElement)(S.Placeholder,{icon:c.icon,label:Object(r.__)("Google Drive File Preview","map-blocks"),notices:u},Object(o.createElement)(o.Fragment,null,a&&d,Object(o.createElement)("div",{className:n},Object(r.__)("Paste your Google Drive Sharing URL into the field below.","rt-google-embeds")),Object(o.createElement)(S.TextControl,{placeholder:Object(r.__)("Paste File URL Here","rt-google-embeds"),value:s,onChange:function(t){return e.apiCall(t)}}))),m=Object(o.createElement)(o.Fragment,null,a&&d,Object(o.createElement)("div",{className:"rt-google-doc-embed"},Object(o.createElement)("a",{href:s,title:Object(r.__)("Open the Shared Document","rt-google-embeds"),target:"_blank",rel:"noopener noreferrer"},Object(r.__)("Open the Shared Document","rt-google-embeds")),Object(o.createElement)("img",{src:a,alt:Object(r.__)("Shared Document Preview","rt-google-embeds")})));return Object(o.createElement)(o.Fragment,null,l,!b&&f&&g,!b&&!f&&h,b&&m)}}]),t}(o.Component);Object(S.withNotices)(k),o.Component}]);